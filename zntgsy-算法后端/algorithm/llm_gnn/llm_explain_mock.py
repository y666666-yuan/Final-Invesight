from core import sys
import json

cache_data = {}
# 用户ID替换映射（重复用户 -> 代表用户）
user_replacement_map = {
    "1": "1",
    "2": "2",
    "3": "3",
    "4": "4",
    "5": "5",
    "6": "6",
    "7": "7",
    "8": "2",
    "9": "5",
    "10": "5",
    "11": "5",
    "12": "12",
    "13": "5",
    "14": "4",
    "15": "15",
    "16": "15",
    "17": "15",
    "18": "3",
    "19": "12",
    "20": "1",
    "21": "1",
    "24": "5",
    "25": "25",
    "26": "12",
    "27": "3",
    "28": "28",
    "29": "3",
    "30": "30",
    "31": "25",
    "32": "25",
    "33": "33",
    "34": "34",
    "35": "33",
    "36": "28",
    "37": "2",
    "38": "34",
    "39": "39",
    "40": "34",
    "41": "41",
    "42": "2",
    "43": "2",
    "44": "34",
    "45": "28",
    "46": "2",
    "47": "5",
    "48": "2",
    "49": "34",
    "50": "25",
    "52": "30",
    "54": "5",
    "55": "5",
    "56": "1",
    "57": "2",
    "59": "2",
    "62": "5",
    "63": "2",
    "64": "2",
    "65": "41",
    "66": "5",
    "67": "1",
    "68": "5",
    "69": "1",
    "70": "4",
    "71": "7",
    "72": "2",
    "74": "2",
    "75": "2",
    "77": "1",
    "79": "34",
    "80": "4",
    "81": "1",
    "83": "3",
    "84": "4",
    "85": "5",
    "87": "2",
    "89": "39",
    "90": "5",
    "91": "4",
    "93": "5",
    "95": "28",
    "96": "34",
    "97": "97",
    "98": "2",
    "99": "25",
    "100": "30",
    "101": "5",
    "102": "34",
    "103": "3",
    "104": "5",
    "105": "34",
    "106": "1",
    "108": "7",
    "109": "34",
    "111": "2",
    "112": "1",
    "114": "33",
    "115": "2",
    "117": "1",
    "120": "5",
    "121": "2",
    "122": "34",
    "123": "5",
    "124": "2",
    "125": "1",
    "126": "2",
    "127": "127",
    "129": "2",
    "131": "2",
    "132": "30",
    "133": "41",
    "134": "30",
    "137": "34",
    "138": "5",
    "140": "1",
    "141": "30",
    "143": "2",
    "144": "41",
    "147": "25",
    "150": "30",
    "151": "2",
    "152": "2",
    "155": "30",
    "156": "2",
    "158": "30",
    "160": "6",
    "161": "34",
    "162": "25",
    "164": "127",
    "166": "25",
    "168": "5",
    "169": "1",
    "171": "25",
    "172": "1",
    "174": "5",
    "177": "4",
    "180": "3",
    "190": "30",
    "193": "1",
    "195": "2",
    "198": "30",
    "203": "28",
    "205": "2",
    "210": "5",
    "212": "34",
    "213": "5",
    "216": "25",
    "217": "33",
    "218": "30",
    "219": "2",
    "220": "34",
    "221": "2",
    "222": "25",
    "224": "1",
    "225": "30",
    "229": "2",
    "231": "231",
    "236": "127",
    "237": "237",
    "240": "240",
    "241": "41",
    "242": "2",
    "243": "41",
    "249": "5",
    "250": "2",
    "252": "2",
    "253": "2",
    "254": "34",
    "255": "2",
    "256": "2",
    "259": "2",
    "260": "34",
    "264": "25",
    "266": "34",
    "267": "267",
    "268": "2",
    "270": "25",
    "271": "25",
    "273": "2",
    "276": "5",
    "277": "25",
    "281": "2",
    "282": "33",
    "283": "2",
    "284": "2",
    "285": "4",
    "288": "2",
    "290": "5",
    "291": "2",
    "292": "5",
    "294": "34",
    "296": "296",
    "297": "25",
    "299": "299",
    "301": "5",
    "303": "34",
    "304": "34",
    "305": "15",
    "306": "5",
    "311": "267",
    "312": "2",
    "314": "237",
    "317": "12",
    "320": "127",
    "324": "41",
    "328": "2",
    "331": "41",
    "332": "12",
    "335": "2",
    "337": "34",
    "340": "2",
    "341": "25",
    "343": "6",
    "345": "12",
    "346": "30",
    "347": "25",
    "353": "267",
    "358": "25",
    "362": "12",
    "364": "2",
    "367": "2",
    "370": "2",
    "372": "34",
    "374": "33",
    "378": "12",
    "382": "2",
    "383": "2",
    "387": "2",
    "388": "12",
    "389": "30",
    "394": "296",
    "396": "396",
    "397": "12",
    "399": "2",
    "402": "34",
    "404": "2",
    "405": "1",
    "411": "4",
    "412": "237",
    "413": "34",
    "418": "4",
    "420": "34",
    "421": "4",
    "424": "41",
    "427": "1",
    "428": "2",
    "432": "25",
    "433": "5",
    "436": "28",
    "438": "4",
    "439": "5",
    "441": "30",
    "444": "25",
    "445": "5",
    "447": "41",
    "448": "25",
    "450": "33",
    "454": "25",
    "455": "455",
    "457": "4",
    "460": "33",
    "462": "2",
    "464": "4",
    "473": "25",
    "475": "28",
    "476": "2",
    "478": "34",
    "483": "2",
    "487": "15",
    "488": "488",
    "491": "25",
    "494": "25",
    "496": "34",
    "503": "2",
    "505": "2",
    "506": "4",
    "513": "299",
    "514": "33",
    "517": "2",
    "530": "34",
    "533": "25",
    "535": "2",
    "539": "5",
    "541": "25",
    "544": "2",
    "545": "25",
    "551": "5",
    "553": "12",
    "557": "237",
    "567": "3",
    "570": "2",
    "574": "1",
    "578": "39",
    "579": "5",
    "583": "5",
    "585": "2",
    "586": "39",
    "587": "2",
    "588": "455",
    "590": "5",
    "594": "34",
    "595": "33",
    "601": "34",
    "603": "25",
    "604": "30",
    "610": "33",
    "611": "3",
    "613": "30",
    "616": "41",
    "623": "5",
    "625": "5",
    "638": "2",
    "640": "2",
    "647": "15",
    "649": "33",
    "656": "656",
    "660": "299",
    "663": "4",
    "664": "25",
    "667": "15",
    "672": "5",
    "676": "2",
    "678": "6",
    "681": "7",
    "683": "34",
    "685": "7",
    "691": "240",
    "694": "30",
    "702": "2",
    "706": "706",
    "709": "34",
    "710": "4",
    "711": "299",
    "729": "5",
    "730": "4",
    "731": "2",
    "737": "396",
    "747": "5",
    "750": "3",
    "752": "5",
    "757": "2",
    "758": "488",
    "767": "267",
    "774": "3",
    "777": "41",
    "784": "34",
    "794": "12",
    "799": "127",
    "803": "3",
    "810": "455",
    "815": "34",
    "816": "2",
    "817": "15",
    "821": "2",
    "824": "30",
    "827": "30",
    "831": "97",
    "833": "455",
    "838": "1",
    "841": "34",
    "845": "34",
    "855": "1",
    "861": "2",
    "874": "299",
    "879": "41",
    "880": "33",
    "882": "267",
    "888": "25",
    "893": "5",
    "904": "7",
    "905": "5",
    "910": "7",
    "911": "34",
    "920": "267",
    "923": "2",
    "940": "33",
    "944": "5",
    "964": "396",
    "981": "5",
    "982": "127",
    "1003": "5",
    "1014": "15",
    "1017": "3",
    "1022": "41",
    "1040": "1040",
    "1054": "3",
    "1057": "28",
    "1060": "34",
    "1078": "299",
    "1082": "12",
    "1083": "5",
    "1091": "41",
    "1094": "41",
    "1096": "33",
    "1097": "5",
    "1110": "33",
    "1114": "30",
    "1116": "28",
    "1131": "3",
    "1136": "34",
    "1159": "1040",
    "1160": "240",
    "1172": "41",
    "1177": "237",
    "1186": "41",
    "1189": "34",
    "1193": "33",
    "1195": "7",
    "1208": "15",
    "1217": "34",
    "1230": "6",
    "1242": "1242",
    "1247": "33",
    "1263": "1",
    "1282": "5",
    "1310": "33",
    "1330": "1",
    "1368": "1368",
    "1373": "34",
    "1378": "30",
    "1382": "1",
    "1388": "34",
    "1400": "1",
    "1425": "1",
    "1455": "2",
    "1458": "30",
    "1461": "33",
    "1464": "41",
    "1483": "30",
    "1491": "6",
    "1494": "34",
    "1503": "5",
    "1505": "127",
    "1530": "34",
    "1545": "3",
    "1579": "4",
    "1612": "25",
    "1640": "28",
    "1644": "15",
    "1679": "28",
    "1686": "3",
    "1697": "25",
    "1723": "127",
    "1740": "34",
    "1783": "2",
    "1794": "240",
    "1798": "5",
    "1819": "15",
    "1821": "25",
    "1840": "488",
    "1867": "34",
    "1884": "237",
    "1889": "2",
    "1893": "1893",
    "1909": "5",
    "1917": "25",
    "1934": "33",
    "1942": "656",
    "1965": "240",
    "1967": "25",
    "1971": "15",
    "1985": "5",
    "1990": "25",
    "2006": "2",
    "2042": "28",
    "2049": "34",
    "2053": "25",
    "2084": "296",
    "2089": "1",
    "2093": "2",
    "2099": "5",
    "2112": "30",
    "2128": "1",
    "2145": "240",
    "2153": "34",
    "2180": "5",
    "2184": "2",
    "2187": "237",
    "2201": "127",
    "2207": "1893",
    "2235": "5",
    "2248": "41",
    "2251": "5",
    "2272": "5",
    "2275": "127",
    "2281": "41",
    "2284": "2",
    "2285": "2",
    "2288": "1",
    "2299": "41",
    "2324": "15",
    "2332": "41",
    "2353": "127",
    "2356": "1",
    "2360": "97",
    "2363": "1",
    "2376": "656",
    "2388": "6",
    "2389": "12",
    "2402": "237",
    "2408": "6"
}

# 产品ID替换映射（重复产品 -> 代表产品）
item_replacement_map = {
    "25481919": "25481919",
    "27681449": "27681449",
    "31585977": "31585977",
    "25325503": "25481919",
    "13346795": "25481919",
    "32287852": "32287852",
    "28459146": "28459146",
    "29640304": "29640304",
    "25580999": "25580999",
    "26956744": "25481919",
    "16567929": "25481919",
    "26778686": "25481919",
    "10577160": "25580999",
    "15438671": "25481919",
    "12242192": "12242192",
    "12024167": "12024167",
    "41718571": "41718571",
    "40102568": "25481919",
    "40679410": "29640304",
    "26983015": "26983015",
    "27163008": "27163008",
    "27022672": "25481919",
    "34413233": "27681449",
    "15296972": "25580999",
    "16672928": "16672928",
    "35773150": "16672928",
    "13086260": "27681449",
    "47641152": "12242192",
    "37746564": "41718571",
    "51728044": "27681449",
    "14706796": "25481919",
    "9070129": "25481919",
    "9024033": "41718571",
    "26127092": "25481919",
    "30641900": "30641900",
    "12940193": "25481919",
    "27100261": "28459146",
    "34383371": "34383371",
    "33129674": "31585977",
    "26408770": "25580999",
    "28863306": "16672928",
    "21423481": "25580999",
    "64389832": "64389832",
    "41180074": "12242192",
    "27139301": "25580999",
    "31259333": "25580999",
    "34747121": "34747121",
    "21614767": "21614767",
    "10147062": "12024167",
    "15141260": "34747121",
    "43711062": "25580999",
    "13734737": "31585977",
    "9535900": "29640304",
    "47552244": "12242192",
    "29079084": "25580999",
    "27945294": "25580999",
    "62725585": "41718571",
    "12321381": "27163008",
    "17430811": "25580999",
    "47404395": "28459146",
    "16561658": "25580999",
    "18028383": "34383371",
    "10367292": "25580999",
    "31776818": "31585977",
    "9492658": "25580999",
    "31375002": "21614767",
    "30291790": "25580999",
    "12904858": "16672928",
    "15342730": "34747121",
    "25081584": "25081584",
    "47782056": "12024167",
    "9785955": "21614767",
    "30558190": "25580999",
    "36560697": "64389832",
    "15643076": "25580999",
    "31043820": "25580999",
    "27444180": "31585977",
    "15421158": "25580999",
    "30990524": "25580999",
    "28788953": "25081584",
    "34044740": "34044740",
    "30064797": "30064797",
    "17608480": "25580999",
    "11213001": "34044740",
    "9213729": "34747121",
    "28697819": "25580999",
    "34829772": "32287852",
    "29647606": "29647606",
    "54515184": "54515184",
    "12291729": "12242192",
    "10618252": "25580999",
    "11524023": "31585977",
    "26713081": "64389832",
    "35075096": "25580999",
    "26076267": "34747121",
    "25681278": "64389832",
    "34259995": "28459146",
    "11654956": "29640304",
    "35688869": "34747121",
    "32686109": "34044740"
}


def get_llm_explain(user_id: int, item_id: int):
    build_cache_data()
    return cache_data[str(user_id) + '|' + str(item_id)]


def build_cache_data():
    if len(cache_data) != 0:
        return
    with open(sys.get_file_path("data/sys_file/tst_predictions_batch.json"), 'r', encoding='utf-8') as file:
        data = json.load(file)
    map = {}
    for item in data:
        map_key = str(item['original_user_id']) + "|" + str(item['original_item_id'])
        map[map_key] = item['explanation']

    for user_id in user_replacement_map:

        for item_id in item_replacement_map:
            if str(user_replacement_map[user_id]) + '|' + str(item_replacement_map[item_id]) in map:
                cache_data[user_id + '|' + item_id] = map[
                    str(user_replacement_map[user_id]) + '|' + str(item_replacement_map[item_id])]
            else:
                cache_data[user_id + '|' + item_id] = ''
    print("刷新大模型解释缓存")


if __name__ == '__main__':
    print(get_llm_explain(user_id=1, item_id=12024167))
